<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1a2332">
  <title>BMM Challenge â€” Corporate Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/app.css">
  <style>
    .dashboard-container { max-width: 960px; margin: 0 auto; padding: 24px; }
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0; }
    .metric-card { background: var(--white); border-radius: var(--radius-lg); padding: 20px; text-align: center; box-shadow: var(--shadow); border: 1px solid var(--border); }
    .metric-value { font-size: 2rem; font-weight: 700; color: var(--navy); }
    .metric-label { font-size: 0.8rem; color: var(--slate); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }
    .participant-table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
    .participant-table th { text-align: left; padding: 10px 12px; background: var(--bg); color: var(--slate); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid var(--border); }
    .participant-table td { padding: 10px 12px; border-bottom: 1px solid var(--border); }
    .participant-table tr:hover td { background: var(--bg); }
    .status-active { color: var(--green); font-weight: 600; }
    .status-inactive { color: var(--red); }
    .invite-section { display: flex; gap: 8px; margin: 12px 0; }
    .invite-section input { flex: 1; }
    .tab-bar { display: flex; gap: 4px; margin-bottom: 16px; border-bottom: 2px solid var(--border); }
    .tab-btn { padding: 10px 20px; background: none; border: none; font-size: 0.9rem; font-weight: 600; color: var(--slate); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; }
    .tab-btn.active { color: var(--navy); border-bottom-color: var(--green); }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    @media print {
      .app-header, .tab-bar, #participant-search, #refresh-data, #admin-signout { display: none !important; }
      .dashboard-container { max-width: 100%; padding: 0; }
      .tab-panel { display: block !important; page-break-inside: avoid; }
      .detail-overlay { display: none !important; }
      body { background: white; }
      .metric-card, .card { box-shadow: none; border: 1px solid #ddd; }
    }

    @media (max-width: 600px) {
      .dashboard-container { padding: 12px; }
      .dashboard-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
      .metric-card { padding: 14px 8px; }
      .metric-value { font-size: 1.5rem; }
      .participant-table { font-size: 0.75rem; }
      .participant-table th, .participant-table td { padding: 8px 6px; }
      .tab-btn { padding: 8px 12px; font-size: 0.8rem; }
    }
    .participant-table tr { cursor: pointer; }
    .detail-overlay { position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:200;display:flex;align-items:center;justify-content:center;padding:16px; }
    .detail-panel { background:var(--white);border-radius:var(--radius-lg);max-width:560px;width:100%;max-height:85vh;overflow-y:auto;padding:24px;position:relative; }
    .detail-close { position:absolute;top:12px;right:16px;background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--slate); }
    .detail-stat { display:inline-block;background:var(--bg);padding:6px 12px;border-radius:var(--radius);font-size:0.8rem;margin:4px; }
    .detail-log-row { display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--border);font-size:0.8rem; }
  </style>
</head>
<body>
  <!-- Admin Auth Screen -->
  <div id="admin-auth" class="auth-screen">
    <div class="logo">BMM Corporate Dashboard</div>
    <div class="tagline">Admin Access</div>
    <div class="auth-box">
      <h2>Admin Sign In</h2>
      <div id="admin-error" class="error-msg"></div>
      <form id="admin-auth-form">
        <div class="form-group">
          <label for="admin-email">Email</label>
          <input type="email" id="admin-email" required autocomplete="email">
        </div>
        <div class="form-group">
          <label for="admin-password">Password</label>
          <input type="password" id="admin-password" required autocomplete="current-password">
        </div>
        <button type="submit" class="btn btn-primary btn-full">Sign In</button>
      </form>
      <div style="text-align:center;margin-top:12px;">
        <a href="#" id="admin-forgot-link" style="font-size:0.85rem;color:var(--slate);">Forgot password?</a>
      </div>
      <div id="admin-reset-sent" style="display:none;text-align:center;color:var(--green);font-size:0.85rem;padding:8px;">Reset email sent!</div>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" style="display:none;">
    <header class="app-header" style="display:flex;align-items:center;justify-content:space-between;padding:16px 24px;">
      <div>
        <h1 style="font-size:1.25rem;">BMM Corporate Dashboard</h1>
        <div class="subtitle" id="company-name"></div>
      </div>
      <button class="btn btn-outline" id="admin-signout" style="color:var(--white);border-color:rgba(255,255,255,0.3);padding:8px 16px;font-size:0.8rem;">Sign Out</button>
    </header>

    <!-- Participant Detail Overlay -->
    <div id="detail-overlay" class="detail-overlay" style="display:none;">
      <div class="detail-panel">
        <button class="detail-close" id="detail-close">&times;</button>
        <div id="detail-content"></div>
      </div>
    </div>

    <div class="dashboard-container">
      <!-- Metrics -->
      <div class="dashboard-grid" id="metrics-grid">
        <div class="metric-card">
          <div class="metric-value" id="m-participants">0</div>
          <div class="metric-label">Participants</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="m-active">0%</div>
          <div class="metric-label">Active Today</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="m-avg-stress">-</div>
          <div class="metric-label">Avg Stress</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="m-completion">0%</div>
          <div class="metric-label">Avg Completion</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="m-at-risk" style="color:var(--green);">0</div>
          <div class="metric-label">At Risk (3+ days)</div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="participants">Participants</button>
        <button class="tab-btn" data-tab="assessments">Assessments</button>
        <button class="tab-btn" data-tab="invite">Invite</button>
        <button class="tab-btn" data-tab="export">Export</button>
      </div>

      <!-- Participants Tab -->
      <div class="tab-panel active" id="tab-participants">
        <div class="card">
          <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center;">
            <input type="text" id="participant-search" placeholder="Search by name or email..." style="flex:1;padding:8px 12px;border:1px solid var(--border);border-radius:var(--radius);font-size:0.85rem;">
            <button class="btn btn-outline" id="refresh-data" style="padding:8px 12px;font-size:0.8rem;" title="Refresh data">&#8635;</button>
          </div>
          <table class="participant-table">
            <thead>
              <tr>
                <th class="sortable" data-sort="name" style="cursor:pointer;">Name &#8597;</th>
                <th class="sortable" data-sort="currentDay" style="cursor:pointer;">Day &#8597;</th>
                <th class="sortable" data-sort="streak" style="cursor:pointer;">Streak &#8597;</th>
                <th class="sortable" data-sort="completionPct" style="cursor:pointer;">Completion &#8597;</th>
                <th class="sortable" data-sort="lastCheckinDay" style="cursor:pointer;">Last Check-in &#8597;</th>
              </tr>
            </thead>
            <tbody id="participant-rows"></tbody>
          </table>
        </div>
      </div>

      <!-- Assessments Tab -->
      <div class="tab-panel" id="tab-assessments">
        <div class="card">
          <h3>Pre/Post Assessment Results</h3>
          <p style="color:var(--slate);font-size:0.875rem;margin-bottom:12px;">Participants who completed both pre and post assessments.</p>
          <div id="assessment-results">
            <p style="color:var(--slate);font-size:0.8rem;">Loading assessment data...</p>
          </div>
        </div>
      </div>

      <!-- Invite Tab -->
      <div class="tab-panel" id="tab-invite">
        <div class="card">
          <h3>Invite Employees</h3>
          <p style="margin-bottom:12px;color:var(--slate);font-size:0.875rem;">Share this invite code with your employees. They'll use it when signing up for the challenge.</p>
          <div style="background:var(--bg);padding:16px;border-radius:var(--radius);text-align:center;margin-bottom:16px;">
            <div style="font-size:0.75rem;color:var(--slate);text-transform:uppercase;margin-bottom:4px;">Invite Code</div>
            <div style="font-size:1.5rem;font-weight:700;color:var(--navy);letter-spacing:2px;" id="invite-code">---</div>
            <button class="btn btn-outline" style="margin-top:8px;" id="copy-code">Copy Code</button>
          </div>
          <button class="btn btn-primary btn-full" id="gen-code">Generate New Code</button>
        </div>
      </div>

      <!-- Export Tab -->
      <div class="tab-panel" id="tab-export">
        <div class="card">
          <h3>Export Data</h3>
          <p style="margin-bottom:16px;color:var(--slate);font-size:0.875rem;">Download participant data as CSV for your HR review.</p>
          <button class="btn btn-primary btn-full" id="export-csv">Export CSV</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="/js/firebase-config.js"></script>
  <script src="/js/admin.js"></script>
</body>
</html>
